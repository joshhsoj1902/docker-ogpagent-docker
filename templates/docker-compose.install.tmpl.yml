version: '3.2'
secrets:
  gcloud:
    external: true
services:
  gcloud:
    image: joshhsoj1902/google-cloud-sdk-docker:latest@sha256:0b87d66fdc9eacc108f23d4e3bb813216808876a27366d4169b2eabe3eb92969
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    secrets:
      - gcloud
    deploy:
      mode: global
      placement:
        constraints:
          - node.labels.games == true
      restart_policy:
        condition: none
    command: sh -c "gcloud auth activate-service-account --key-file=/run/secrets/gcloud && gcloud docker -- pull {{(datasource "config").namespace}}/{{(datasource "config").image}}:{{(datasource "config").version}}"
    
