version: '3.2'
secrets:
  gcloud:
    external: true
services:
  gcloud:
    image: joshhsoj1902/google-cloud-sdk-docker:latest@sha256:ef95cf20cb41cc1977031ba80f37193bbc5660df9a58363cb2693c40467af025
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    secrets:
      - gcloud
    deploy:
      mode: global
      placement:
        constraints:
          - node.labels.games == true
      restart_policy:
        condition: none
    command: sh -c "gcloud auth activate-service-account --key-file=/run/secrets/gcloud && gcloud docker -- pull {{(datasource "config").namespace}}/{{(datasource "config").image}}:{{(datasource "config").version}}"
    
